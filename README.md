# MCP Jira & Confluence

MCP сервер для интеграции с Jira и Confluence. Позволяет Cursor AI работать с задачами Jira, ворклогами и контентом Confluence прямо в среде разработки.

## Возможности

### Jira
- Поддержка Jira Server/Data Center (Personal Access Token)
- Поддержка Atlassian Cloud (API Token)
- Получение описания задач
- Получение комментариев к задачам
- **Поиск задач** по названию и описанию с фильтрацией
- **Анализ ворклогов** за любой период времени
- **Детальные отчеты** с описаниями задач и затраченным временем
- **Автоматическое исключение** коммуникационных подзадач
- **Гибкие фильтры** по проектам и типам задач

### Confluence
- Получение контента страниц по ID или URL
- Поиск страниц по заголовку и содержимому
- Поддержка страниц и блог-постов
- Фильтрация по пространствам (spaces)
- Получение метаданных страниц (автор, дата создания, версия)

## Установка

1. **Создайте .env файл** на основе .env.example
2. **Установите зависимости**: `yarn install && yarn build`
3. **Добавьте в Cursor MCP конфигурацию**

## Настройка

### Jira

**Для Jira Server/Data Center:**
```env
JIRA_HOST=https://jira.yourcompany.com
JIRA_USERNAME=ваш_логин
JIRA_API_TOKEN=ваш_personal_access_token
```

**Для Atlassian Cloud:**
```env
JIRA_HOST=https://yourcompany.atlassian.net
JIRA_USERNAME=your.email@company.com
JIRA_API_TOKEN=ваш_api_token
```

### Confluence

**Отдельные настройки для Confluence:**
```env
CONFLUENCE_HOST=https://confluence.yourcompany.com
CONFLUENCE_USERNAME=ваш_логин (или JIRA_USERNAME)
CONFLUENCE_API_TOKEN=ваш_api_token
```

## Использование

### Работа с задачами Jira
- "Покажи описание задачи VIM-27113"
- "Какие комментарии к PROJ-456?"

### Поиск задач
- "Найди задачи со словом 'авторизация'"
- "Покажи все задачи с багами в проекте VIM"
- "Найди задачи назначенные мне со словом 'API'"

### Анализ ворклогов
- "Покажи мои ворклоги за последний месяц"
- "Получи подробный список задач за полгода"
- "Покажи ворклоги коллеги за 180 дней"

### Работа с Confluence
- "Покажи содержимое страницы Confluence 123456"
- "Получи контент страницы https://confluence.company.com/pages/viewpage.action?pageId=123456"

## Доступные инструменты

### Jira

#### `read-description`
Получение описания задачи по ключу.

#### `read-comments`
Получение комментариев к задаче.

#### `search-issues`
Поиск задач по названию (summary) и описанию (description):
- `query` - поисковый запрос (ищет в заголовке и описании задач)
- `projectKeys` - фильтр по проектам (опционально)
- `status` - фильтр по статусам (например: ['Open', 'In Progress', 'Done'])
- `assignee` - фильтр по исполнителю (username или 'currentUser()')
- `maxResults` - максимальное количество результатов (по умолчанию: 20, максимум: 100)
- `includeDescription` - включать описание в результаты (по умолчанию: true)

#### `get-worklogs`
Получение ворклогов за точный период с детальной информацией:
- `startDate`, `endDate` - точные даты в формате YYYY-MM-DD
- `username` - логин пользователя (опционально, по умолчанию текущий)
- `projectKeys` - фильтр по проектам
- `includeSubtasks` - включать подзадачи
- `includeCommunication` - включать коммуникационные задачи (COM-*)

#### `get-worklogs-by-days`
Гибкий анализ ворклогов по количеству дней:
- `days` - количество дней назад (например: 180 для полугода, 30 для месяца)
- `endDate` - конечная дата (опционально, по умолчанию текущая)
- Остальные параметры как в `get-worklogs`

#### `get-recent-worklogs`
Быстрый просмотр за стандартные периоды:
- `period` - week, month, 3months, 6months, year
- `username` - логин пользователя (опционально)
- `projectKeys` - фильтр по проектам

### Confluence

#### `get-confluence-page`
Получение содержимого страницы Confluence:
- `pageIdOrUrl` - ID страницы (например, 123456) или полный URL страницы
- `includeBody` - включать содержимое страницы (по умолчанию: true)
- `expandProperties` - дополнительные свойства для получения (опционально)

#### `search-confluence-pages`
Поиск страниц в Confluence:
- `query` - поисковый запрос (заголовок или содержимое)
- `spaceKey` - ограничить поиск определенным пространством (опционально)
- `type` - тип контента: page или blogpost (по умолчанию: page)
- `limit` - максимальное количество результатов (по умолчанию: 10, максимум: 50)

## Особенности

### Jira
- **Исключение коммуникационных задач**: Автоматически фильтрует подзадачи с суффиксом "communications" (обсуждения, код-ревью)
- **Форматирование времени**: Отображение в днях, часах и минутах (8-часовой рабочий день)
- **Поддержка временных зон**: Корректная работа с датами ворклогов
- **Детальная информация**: Включает описания задач, URL, статус, приоритет и полные ворклоги

### Confluence
- **Гибкое извлечение ID**: Автоматическое извлечение ID страницы из URL
- **Богатые метаданные**: Информация об авторе, дате создания, версии и пространстве
- **Поиск с фильтрацией**: Возможность ограничить поиск конкретным пространством
- **Поддержка разных типов контента**: Страницы и блог-посты
- **Содержимое в формате Storage**: Получение содержимого в исходном формате Confluence
